\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{xaufgaben}[2025/12/27 LaTeX package for easy tasks numbering]

\newif\if@chapter\@chapterfalse
\newif\if@section\@sectionfalse

\DeclareOption{chapter}{\@chaptertrue\@sectionfalse}
\DeclareOption{section}{\@chapterfalse\@sectiontrue}
\ProcessOptions\relax

\RequirePackage{xsim}
\RequirePackage{tasks}

\let\Sectionmark\sectionmark
\def\sectionmark#1{\def\Sectionname{#1}\Sectionmark{#1}}

% Взято из официального мануала к пакету xsim.
% Модифицировано под мои нужды.
% Также см. https://tex.stackexchange.com/a/160035
% Также см. https://tex.stackexchange.com/a/62252
\DeclareExerciseEnvironmentTemplate{runin}{%
  \IfInsideSolutionTF{%
    \protected@write\@auxout{}{%
      \string\newlabel{sol:\GetExerciseProperty{ID}}{%
        {\GetExerciseProperty{counter}}%
        {\thepage}%
        {\Sectionname}%
        {solution.\GetExerciseProperty{ID}}{}%
      }%
    }%
    \hypertarget{solution.\GetExerciseProperty{ID}}{}%
  }{%
    \label{ex:\GetExerciseProperty{ID}}}
  \par%
  \noindent
  \textbf{\XSIMmixedcase{\GetExerciseName}~\GetExerciseProperty{counter}}%
  \GetExercisePropertyT{subtitle}{ \textit{#1}} % <<< notice the space
  \IfInsideSolutionF{%
    \GetExercisePropertyT{points}{%
      \marginpar{%
        \printgoal{\PropertyValue}%
        \GetExercisePropertyT{bonus-points}{+\printgoal{\PropertyValue}}%
        \,\IfExerciseGoalSingularTF{points}
        {\XSIMtranslate{point}}
        {\XSIMtranslate{points}}%
      }%
    }%
  }%
}
{}

\xsimsetup{
  exercise/template=runin,
  solution/template=runin
}

\if@chapter\xsimsetup{exercise/within={chapter}}\else\fi
\if@section\xsimsetup{exercise/within={section}}\else\fi

\DeclareInstance{tasks}{alphabetize}{default}{label = \asbuk*)}
\DeclareInstance{tasks}{itemize}{default}{}
\DeclareInstance{tasks}{enumerate}{default}{label=\arabic*.}

\DeclareExerciseTranslation{Russian}{exercise}{№}
\DeclareExerciseTranslation{Russian}{exercises}{упражнения}
\DeclareExerciseTranslation{Russian}{question}{вопрос}
\DeclareExerciseTranslation{Russian}{questions}{вопросы}
\DeclareExerciseTranslation{Russian}{solution}{решение №}
\DeclareExerciseTranslation{Russian}{solutions}{решения}
\DeclareExerciseTranslation{Russian}{point-abbr}{б.}
\DeclareExerciseTranslation{Russian}{point}{балл}
\DeclareExerciseTranslation{Russian}{points}{баллы}
\DeclareExerciseTranslation{Russian}{reached}{получено}
\DeclareExerciseTranslation{Russian}{default-heading}{Решения упражнений}
\DeclareExerciseTranslation{Russian}{collection-heading}{Упражнения}
\DeclareExerciseTranslation{Russian}{per-section-heading}{Решения упражнений раздела\nobreakspace \ExerciseSection}
\DeclareExerciseTranslation{Russian}{per-chapter-heading}{Решения упражнений главы\nobreakspace \ExerciseChapter}

\endinput
