\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{aufgaben}[2025/09/18 LaTeX package for easy tasks numbering]

\newif\if@taskonly
\@taskonlyfalse

\newif\if@chapter
\@chapterfalse

\DeclareOption{taskonly}{\@taskonlytrue}
\DeclareOption{chapter}{\@chaptertrue}
\ProcessOptions\relax

\RequirePackage{enumitem}
\RequirePackage{xstring}
\RequirePackage{calc}

%%% Упражнения %%%

\newlist{tasks}{enumerate}{3}
\setlist[tasks,1]{%
	label={\textbf{№\if@chapter\arabic{chapter}.\else\fi\arabic*}},
	ref={\if@chapter\arabic{chapter}.\else\fi\arabic*},
	align=left,
	labelindent=0pt,
	labelsep*=.5em,
	labelwidth=\widthof{№\ref{tasksi-\EnumitemId}},
	itemindent=0pt,
	leftmargin=!,
	after={\label{tasksi-\EnumitemId}}
}
\setlist[tasks,2]{%
	label={\arabic*.},
	ref={(\arabic*)},
	align=left,
	labelindent=0pt,
	labelsep*=.5em,
	labelwidth=\widthof{\StrBetween\expandafter{\ref{tasksii-\EnumitemId}}{(}{)}.},
	itemindent=0pt,
	leftmargin=!,
	after={\label{tasksii-\EnumitemId}}
}
\setlist[tasks,3]{%
	label={\asbuk*.},
	ref={(\asbuk*)},
	align=left,
	labelindent=0pt,
	labelsep*=.5em,
	labelwidth=\widthof{\StrBetween\expandafter{\ref{tasksiii-\EnumitemId}}{(}{)}.},
	itemindent=0pt,
	leftmargin=!,
	after={\label{tasksiii-\EnumitemId}}
}

\if@taskonly
\else
	\newcommand*{\answer@text}[1][]{%
		Ответ%
		\ifthenelse{\equal{#1}{}}%
		{}%
		{ (#1)}: %
	}

	\newcommand*{\solution@text}[1][]{%
		Решение%
		\ifthenelse{\equal{#1}{}}%
		{}%
		{ (#1)}: %
	}

	\newcommand*{\answer}[1][]{%
		\if@noskipsec\leavevmode\fi
		\def\@svsechd{%
			\textbf{\answer@text[#1]}}%
		\@xsect{-1em}%
	}

	\newcommand*{\solution}[1][]{%
		\if@noskipsec\leavevmode\fi
		\def\@svsechd{%
			\textbf{\solution@text[#1]}}%
		\@xsect{-1em}%
	}
\fi

\endinput
