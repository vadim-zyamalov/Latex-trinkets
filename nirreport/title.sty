\newcommand*{\No}{\textnumero}
\newcommand*\ulfill{%
  \mbox{}\leaders\hrule depth 2pt height -1.5pt\hfill%
}

% https://tex.stackexchange.com/a/55706
\makeatletter
\newcommand*\ulfillx[1][\linewidth]{%
  \protect\makebox{#1}{\ulfill}
}
\makeatother

% https://tex.stackexchange.com/a/55706
\newcommand*\ultext[2][\linewidth]{%
  \raisebox{%
    -\baselineskip%
  }{%
    \shortstack{%
    \protect\makebox{#1}{\ulfill}\\
    {\footnotesize \centering (#2)}}
  }
}

\newcommand\Nir@Udk{
  УДК~\ulfillx[3em]
}
\newcommand*\NirUdk[1]{%
  \renewcommand\Nir@Udk{#1}%
}

\newcommand\Nir@RegNo{%
  Рег.~\No \ulfillx[3em]%
}
\newcommand*\NirRegNo[1]{%
    \renewcommand\Nir@RegNo{#1}%
}

\newcommand\Nir@InnerNo{
  Рег.~\No \ulfillx[3em]%
}
\newcommand*\NirInnerNo[1]{%
  \renewcommand\Nir@InnerNo{#1}%
}

% Examples number
\newcommand\Nir@Copies{%
    \vspace{-2ex}
}
\newcommand*\NirCopies[1]{%
  \renewcommand\Nir@Copies{#1 экз.}%
}

% Гриф секретности
\newcommand\Nir@Classified{%
  \vspace{-2ex}%
}
\newcommand*\NirGrif[1]{%
  \renewcommand\Nir@Grif{#1}%
}

% Approve text
\newcommand*\Nir@Approve{%
  Утверждаю%
}
\newcommand*\NirApprove[1]{%
  \renewcommand\Nir@Approve{#1}%
}

% Organization name
\newcommand\Nir@OrgLongName{
  \ultext[\linewidth]{предприятие (организация)}%
}
\newcommand\NirOrgLongName[1]{%
  \renewcommand\Nir@OrgLongName{#1}%
}

% Report Name
\newcommand*\Nir@Type{%
  Отчёт%
}
\newcommand\NirType[1]{%
  \renewcommand\Nir@Type{#1}%
}

% Report about text
\newcommand*\Nir@About{
 О{} научно-исследовательской{} работе%
}
\newcommand\NirAbout[1]{%
  \renewcommand\Nir@About{#1}%
}

% Annotated report
\newcommand\Nir@Annotate{}
\newcommand*\NirIsAnnotation[1]{%
  \renewcommand\Nir@Annotate{#1}%
}

% Report part
\newcommand*\Nir@PartNo{%
  \vspace{-2ex}%
}
\newcommand\NirPartNo[2]{%
  \renewcommand\Nir@PartNo{#1 #2}%
}

% Report Year
\newcommand\Nir@Year{\the\year}
\newcommand*\NirYear[1]{%
  \renewcommand\Nir@Year{#1}%
}

\newcommand\Nir@Town{}
\newcommand*\NirTown[1]{%
  \renewcommand\Nir@Town{#1}%
}


\newcommand\Nir@ApproverStamp{
  \parbox[t]{.4\linewidth}{
    {\centering\MakeUppercase{\Nir@Approve}

    }
    \bigskip
    {\raggedright\Nir@ApproverPost

    }
    \bigskip
    \ulfill~\Nir@ApproverName

    \bigskip
    <<\ulfillx[3em]>>~\ulfill~\Nir@Year~г.
  }
}
\newcommand*\NirApproverStamp[1]{%
  \renewcommand\Nir@ApproverStamp{#1}%
}

\newcommand\Nir@ApproverPost{
  \ultext{головной исполнитель НИР}
}
\newcommand*\NirApproverPost[1]{%
  \renewcommand\Nir@ApproverPost{#1}%
}

\newcommand\Nir@ApproverName{%
  \ultext[5em]{Ф.И.О.}%
}
\newcommand*\NirApproverName[1]{%
  \renewcommand\Nir@ApproverName{#1}%
}

\newcommand*\NirApprover[2]{
  \renewcommand\Nir@ApproverPost{#1}
  \renewcommand\Nir@ApproverName{#2}
}

% Head Supervisor stamp
\newcommand\Nir@SupervisorStamp{
  \parbox[t]{0.4\linewidth}{
    Руководитель темы\par
    \Nir@SupervisorPost}
  \hfill
  \ultext[3em]{подпись, дата}
  \hfill
  \Nir@SupervisorName
}
\newcommand*\NirSupervisorStamp[1]{%
  \renewcommand\Nir@SupervisorStamp{#1}}

\newcommand\Nir@SupervisorPost{
    \ultext{научный руководитель НИР}
}
\newcommand*\NirSupervisorPost[1]{%
  \renewcommand\Nir@SupervisorPost{#1}%
}

\newcommand\Nir@SupervisorName{%
  \ultext[5em]{Ф.И.О.}%
}
\newcommand*\NirSupervisorName{%
  \renewcommand\Nir@SupervisorName{}
}

\newcommand*\NirSupervisor[2]{
  \renewcommand\Nir@SupervisorPost{#1}
  \renewcommand\Nir@SupervisorName{#2}
}

% Head executor of research
\newcommand\Nir@ExecutorStamp[1]{%
  \parbox[t]{0.4\linewidth}{
    Исполнитель темы\par
    \Nir@ExecutorPost}
  \hfill
  \ultext[3em]{подпись, дата}
  \hfill
  \Nir@ExecutorName}
\newcommand*\NirExecutorStamp[1]{%
  \renewcommand\Nir@ExecutorStamp{#1}}

\newcommand\Nir@ExecutorPost{%
  \ultext{ответственный исполнитель}
}

\newcommand\Nir@ExecutorName{%
  \ultext[5em]{Ф.И.О.}}
\newcommand*\NirExecutorName{%
  \renewcommand\Nir@ExecutorName{}
}

\newcommand*\NirExecutor{
  \renewcommand\Nir@ExecutorPost{#1}
  \renewcommand\Nir@ExecutorName{#2}
}

\newcommand\Nir@Title{%
  \ultext{наименование}}
\newcommand\NirTitle[1]{%
  \renewcommand\Nir@Title{#1}}

\newcommand\Nir@Subject{%
  \ultext{тема НИР}
}
\newcommand\NirSubject[1]{%
  \renewcommand\Nir@Subject{#1}}

\newcommand\Nir@SubjectModifier{%
  по~теме:
}
\newcommand\NirSubjectModifier{%
  \renewcommand\Nir@SubjectModifier{#1}}

\newcommand\Nir@TitleAndSubject{
  \MakeUppercase{\Nir@Title}\par
  \Nir@SubjectModifier\par
  \MakeUppercase{\Nir@Subject}
}

%
% The simple case when the subject of the report is the same
% as the NIR title -- like in example 2 in ГОСТ 7.32-2001 ред. 2009 года.pdf:

%
% Optionally, specify a different report subject:


%
% The default modifier is as in example 1 in ГОСТ 7.32-2001 ред. 2009 года.pdf:
% "по теме:"

%
% A switch for the variant of the modifier as
% in example 3 in ГОСТ 7.32-2001 ред. 2009 года.pdf:
% (empty)
\newcommand*\NirBareSubject[1]{%
  \renewcommand\NirSubjectModifier{}%
}

% вид отчёта:
% The default "stage type" is "intermediate" ("промежуточный")
% (this default saves typing unless you need a modified stage type):
% "промежуточный"
\newcommand\@intermediatename{промежуточный}
\newcommand\intermediatename[1]{\renewcommand\@intermediatename{#1}}

\newcommand\@finalname{заключительный}
\newcommand\finalname[1]{\renewcommand\@finalname{#1}}

\newcommand\Nir@StageType{\@intermediatename}
% "заключительный"


%Эти команды нужно вызвать для корректного определения титульной страницы

% One of the "stage type" variants
% (if different from the default "intermediate")
% -- set to "final"/"заключительный" if the arg is silently omitted.
% The second variant is not supported
% by any example in ГОСТ 7.32-2001 ред. 2009 года.pdf,
% but it is like in a document example I've seen elsewhere.
\newcommand*\NirFinal[1][\@finalname]{%
  \renewcommand\Nir@StageType{#1}%
}
\newcommand*\NirFinalStage[2][\@finalname]{%
  \renewcommand\Nir@StageType{#1, #2}%
} % Usage: \NirFinalStage[промежуточный]{этап~3}

% Following allows to change command arguments
          % to change finalname  text

\newcommand\Nir@Code{шифр\,---\,\makebox[6em]{\ulfill}}
\newcommand*\NirCode[1]{\renewcommand\Nir@Code{#1}} % Code of report changeable

\newlength{\savedparskip}

\renewenvironment*{titlepage}{
  \setlength{\savedparskip}{\parskip}
  \setlength{\parskip}{\z@}}
  \thispagestyle{empty}
  \linespread{1.1}\normalsize

  \begin{centering}
    {{\Nir@OrgLongName}} % name of Institute

  \begin{centering}
        \vfill

        \parbox[t]{.45\linewidth}{
            \Nir@Udk\\ % UDK name and number
            \Nir@RegNo\\       %Reg name and number
            \Nir@InnerNo\\ %Inventory name and number
        }
        \hfill\Nir@ApproverStamp

        \vfill

        \MakeUppercase{\Nir@Annotate \Nir@Type}\\ % Annotated and Report name
        \MakeUppercase{\Nir@About}         % Report about

        \vspace{2ex}
        \Nir@TitleAndSubject          % Report Subject

        \vfill

        \Nir@SupervisorStamp

        \vfill

        \vfill

        \Nir@Town~\Nir@Year

    \end{centering}
    \renewcommand\baselinestretch{\nirreport@linestretch}\normalsize
    \setlength{\parskip}{\savedparskip}
}
